<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>åŠŸè¿‡æ ¼ - ä»Šæ—¥åˆ—è¡¨</title>
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/animations.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200;300;400;500;600;700;900&family=Noto+Serif+JP:wght@200;300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <style>
    /* å›ºå®šå¯¼èˆªæ  */
    .nav-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--color-bg);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--color-border-light);
      margin-bottom: 0;
    }

    /* å¯¼èˆªæ  */
    /* .nav-header {
      opacity: 0;
      animation: fadeIn 0.4s ease-out forwards;
    } */

    /* æ—¥æœŸå¤´éƒ¨ */
    .date-header {
      text-align: center;
      padding: 20px 24px 10px;
      position: relative;
      z-index: 2;
      opacity: 0;
      animation: slideDown 0.5s ease-out 0.1s forwards;
    }

    .date-main {
      font-size: 20px;
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 6px;
      letter-spacing: 2px;
    }

    .date-sub {
      font-size: 12px;
      color: var(--color-text);
      opacity: 0.4;
      letter-spacing: 1px;
    }

    /* ç»Ÿè®¡åŒºåŸŸ */
    .summary {
      display: flex;
      justify-content: center;
      gap: 50px;
      padding: 20px 24px 30px;
      position: relative;
      z-index: 2;
      opacity: 0;
      animation: slideUp 0.5s ease-out 0.2s forwards;
    }

    .summary-item {
      text-align: center;
      position: relative;
    }

    .summary-label {
      font-size: 12px;
      color: var(--color-text);
      opacity: 0.4;
      margin-bottom: 8px;
      letter-spacing: 2px;
    }

    .summary-value {
      font-size: 32px;
      font-weight: 700;
      line-height: 1.2;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s;
    }

    .summary-value.gong {
      color: var(--color-gong);
      text-shadow: 0 4px 12px var(--color-shadow);
    }

    .summary-value.guo {
      color: var(--color-guo);
      text-shadow: 0 4px 12px var(--color-shadow-dark);
    }

    .summary-value.pulse {
      animation: numberPulse 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* åˆ—è¡¨åŒºåŸŸ */
    .list-area {
      padding: 0 24px 100px;
      position: relative;
      z-index: 2;
      min-height: calc(100vh - 280px);
    }

    .list-area::-webkit-scrollbar {
      display: none;
    }

    /* åˆ—è¡¨é¡¹ */
    .list-item {
      display: flex;
      align-items: flex-start;
      padding: 20px 0;
      border-bottom: 1px solid var(--color-border-light);
      position: relative;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      opacity: 0;
      transform: translateX(-20px);
    }

    .list-item:nth-child(1) {
      animation: slideInRight 0.5s ease-out 0.3s forwards;
    }

    .list-item:nth-child(2) {
      animation: slideInRight 0.5s ease-out 0.35s forwards;
    }

    .list-item:nth-child(3) {
      animation: slideInRight 0.5s ease-out 0.4s forwards;
    }

    .list-item:nth-child(4) {
      animation: slideInRight 0.5s ease-out 0.45s forwards;
    }

    .list-item:nth-child(5) {
      animation: slideInRight 0.5s ease-out 0.5s forwards;
    }

    .list-item:nth-child(6) {
      animation: slideInRight 0.5s ease-out 0.55s forwards;
    }

    .list-item:nth-child(7) {
      animation: slideInRight 0.5s ease-out 0.6s forwards;
    }

    .list-item:nth-child(8) {
      animation: slideInRight 0.5s ease-out 0.65s forwards;
    }

    .list-item:nth-child(n+9) {
      animation: slideInRight 0.5s ease-out 0.7s forwards;
    }

    .list-item:hover {
      background: var(--color-border-light);
      margin: 0 -24px;
      padding-left: 24px;
      padding-right: 24px;
      transform: translateX(0);
    }

    .list-item:active {
      transform: scale(0.98);
    }

    .item-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-top: 6px;
      margin-right: 16px;
      flex-shrink: 0;
      transition: transform 0.3s;
    }

    .list-item:hover .item-dot {
      transform: scale(1.2);
    }

    .item-dot.gong {
      background: var(--color-gong);
      box-shadow: 0 2px 8px var(--color-shadow);
    }

    .item-dot.guo {
      background: var(--color-guo);
      opacity: 0.6;
    }

    .item-content {
      flex: 1;
      min-width: 0;
    }

    .item-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .item-time {
      font-size: 12px;
      color: var(--color-text);
      opacity: 0.35;
      letter-spacing: 0.5px;
    }

    .item-amount {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 500;
      white-space: nowrap;
      transition: transform 0.3s;
    }

    .list-item:hover .item-amount {
      transform: scale(1.05);
    }

    .item-amount.gong {
      background: rgba(45, 106, 79, 0.1);
      color: var(--color-gong);
    }

    body.theme-ja .item-amount.gong {
      background: rgba(167, 148, 115, 0.1);
    }

    body.theme-en .item-amount.gong {
      background: rgba(79, 172, 254, 0.1);
    }

    .item-amount.guo {
      background: var(--color-border-light);
      color: var(--color-guo);
    }

    .item-desc {
      font-size: 14px;
      color: var(--color-text);
      opacity: 0.7;
      line-height: 1.6;
      word-break: break-word;
      letter-spacing: 0.5px;
    }

    /* ç©ºçŠ¶æ€ */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
      text-align: center;
      opacity: 0;
      animation: fadeIn 0.6s ease-out 0.3s forwards;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.3;
      animation: zenBreathing 3s ease-in-out infinite;
    }

    .empty-text {
      font-size: 15px;
      color: var(--color-text);
      opacity: 0.4;
      letter-spacing: 2px;
      line-height: 1.6;
    }

    /* æç¤ºæ–‡å­— */
    .hint {
      text-align: center;
      font-size: 11px;
      color: var(--color-text);
      opacity: 0.2;
      margin-top: 30px;
      padding-bottom: 20px;
      letter-spacing: 1px;
      opacity: 0;
      animation: fadeIn 0.6s ease-out 0.8s forwards;
    }

    /* åˆ†å‰²çº¿è£…é¥° */
    .divider-decoration {
      margin: 20px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      opacity: 0.1;
    }

    .divider-line {
      flex: 1;
      height: 1px;
      background: var(--color-text);
    }

    .divider-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--color-text);
    }

    /* å¤šè¯­è¨€é€‚é… */
    body.theme-ja .date-main,
    body.theme-ja .summary-value {
      letter-spacing: 0.1em;
    }

    body.theme-en .date-main {
      letter-spacing: normal;
      font-size: 18px;
    }

    body.theme-en .summary-value {
      font-size: 28px;
      letter-spacing: normal;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 375px) {
      .summary {
        gap: 40px;
      }

      .summary-value {
        font-size: 28px;
      }
    }
  </style>
</head>

<body class="theme-zh">
  <div style="position: relative;">


    <!-- å¯¼èˆªæ  -->
    <div class="nav-header">
      <div class="back-btn" id="backBtn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6" />
        </svg>
      </div>
      <div class="nav-title" data-i18n="today.title">ä»Šæ—¥è®°å½•</div>
      <div class="nav-right"></div>
    </div>

    <!-- æ—¥æœŸå¤´éƒ¨ -->
    <div class="date-header">
      <div class="date-main" id="dateMain">12æœˆ10æ—¥</div>
      <div class="date-sub" id="dateSub">2025å¹´ æ˜ŸæœŸä¸‰</div>
    </div>

    <!-- ç»Ÿè®¡åŒºåŸŸ -->
    <div class="summary">
      <div class="summary-item">
        <div class="summary-label" data-i18n="record.category.gong">åŠŸ</div>
        <div class="summary-value gong" id="gongTotal">ã€‡</div>
      </div>
      <div class="summary-item">
        <div class="summary-label" data-i18n="record.category.guo">è¿‡</div>
        <div class="summary-value guo" id="guoTotal">ã€‡</div>
      </div>
    </div>

    <!-- åˆ—è¡¨åŒºåŸŸ -->
    <div class="list-area" id="listArea">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <script src="js/i18n.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/store.js"></script>
  <script src="js/modals.js"></script>
  <script src="js/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async function () {
      var t = window.i18n ? window.i18n.t : function (k) { return k; };
      var toNum = window.i18n ? window.i18n.toLocalNumber : function (n) { return n; };

      // æ ¼å¼åŒ–æ—¥æœŸ
      function formatDate(date) {
        var locale = window.i18n ? window.i18n.getCurrentLocale() : 'zh';
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var day = date.getDate();
        var weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        var weekday = weekdays[date.getDay()];

        if (locale === 'ja') {
          weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
          weekday = weekdays[date.getDay()];
          return {
            main: month + 'æœˆ' + day + 'æ—¥',
            sub: year + 'å¹´ ' + weekday + 'æ›œæ—¥'
          };
        } else if (locale === 'en') {
          var monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'];
          var weekdayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          return {
            main: monthNames[month - 1] + ' ' + day,
            sub: year + ' Â· ' + weekdayNames[date.getDay()]
          };
        } else {
          return {
            main: month + 'æœˆ' + day + 'æ—¥',
            sub: year + 'å¹´ æ˜ŸæœŸ' + weekday
          };
        }
      }

      // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
      var today = new Date();
      var dateInfo = formatDate(today);
      document.getElementById('dateMain').textContent = dateInfo.main;
      document.getElementById('dateSub').textContent = dateInfo.sub;

      // è¿”å›æŒ‰é’®
      document.getElementById('backBtn').addEventListener('click', function () {
        window.location.href = 'home.html';
      });

      // åŠ è½½æ•°æ®
      if (window.store) {
        var records = await window.store.getTodayRecords();
        var stats = await window.store.getTodayStats();

        // æ›´æ–°ç»Ÿè®¡
        var gongEl = document.getElementById('gongTotal');
        var guoEl = document.getElementById('guoTotal');
        var locale = window.i18n ? window.i18n.getCurrentLocale() : 'zh';
        var zeroText = locale === 'en' ? '0' : 'é›¶';

        function updateStats() {
          var gongVal = (stats && typeof stats.gong === 'number') ? stats.gong : 0;
          var guoVal = (stats && typeof stats.guo === 'number') ? stats.guo : 0;

          var gongNum = gongVal === 0 ? zeroText : toNum(gongVal);
          var guoNum = guoVal === 0 ? zeroText : toNum(guoVal);

          gongEl.textContent = gongNum;
          guoEl.textContent = guoNum;

          // æ·»åŠ è„‰å†²åŠ¨ç”»
          gongEl.classList.add('pulse');
          guoEl.classList.add('pulse');
          setTimeout(function () {
            gongEl.classList.remove('pulse');
            guoEl.classList.remove('pulse');
          }, 400);
        }

        updateStats();

        // æ¸²æŸ“åˆ—è¡¨
        var listArea = document.getElementById('listArea');

        if (records.length === 0) {
          listArea.innerHTML = '<div class="empty-state">' +
            '<div class="empty-icon">ğŸ“</div>' +
            '<div class="empty-text">' + t('today.empty') + '</div>' +
            '<div class="empty-desc" style="font-size: 12px; color: var(--color-text); opacity: 0.5; margin: 12px 0 20px;">' + 
            (t('today.emptyDesc') || 'å¼€å§‹è®°å½•ä½ çš„åŠŸè¿‡ï¼ŒåŸ¹å…»è‡ªçœä¹ æƒ¯') + '</div>' +
            '<button class="empty-action-btn" style="padding: 12px 32px; background: var(--gradient-primary); color: var(--color-bg); border: none; border-radius: var(--radius-md); font-size: 14px; font-weight: 500; cursor: pointer; transition: transform 0.2s;">' +
            (t('today.goRecord') || 'å»è®°å½•') + '</button>' +
            '</div>';
          
          // ç»‘å®šç©ºçŠ¶æ€æŒ‰é’®
          var emptyBtn = listArea.querySelector('.empty-action-btn');
          if (emptyBtn) {
            emptyBtn.addEventListener('click', function() {
              window.location.href = 'record.html?type=gong';
            });
            emptyBtn.addEventListener('mouseenter', function() {
              this.style.transform = 'scale(1.05)';
            });
            emptyBtn.addEventListener('mouseleave', function() {
              this.style.transform = 'scale(1)';
            });
          }
        } else {
          var html = '';

          // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
          records.sort(function (a, b) {
            return b.time.localeCompare(a.time);
          });

          records.forEach(function (record, index) {
            var scoreText = toNum(record.score);
            var typeText = record.type === 'gong' ? t('record.category.gong') : t('record.category.guo');

            // æ ¹æ®è¯­è¨€è°ƒæ•´æ˜¾ç¤º
            var locale = window.i18n ? window.i18n.getCurrentLocale() : 'zh';
            var amountText;
            if (locale === 'en') {
              amountText = (record.type === 'gong' ? '+' : '-') + record.score;
            } else {
              amountText = scoreText + typeText;
            }

            html += '<div class="list-item" data-id="' + record.id + '">' +
              '<div class="item-dot ' + record.type + '"></div>' +
              '<div class="item-content">' +
              '<div class="item-header">' +
              '<span class="item-time">' + record.time + '</span>' +
              '<span class="item-amount ' + record.type + '">' + amountText + '</span>' +
              '</div>' +
              '<div class="item-desc">' + (record.note || '') + '</div>' +
              '</div>' +
              '</div>';
          });

          html += '<div class="hint">' + t('today.hint') + '</div>';
          listArea.innerHTML = html;

          // ç»‘å®šç‚¹å‡»äº‹ä»¶
          listArea.querySelectorAll('.list-item').forEach(function (item) {
            item.addEventListener('click', function () {
              var id = item.dataset.id;
              window.location.href = 'record.html?edit=' + id;
            });
          });
        }
      } else {
        // å¦‚æœæ²¡æœ‰storeï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
        var listArea = document.getElementById('listArea');
        listArea.innerHTML = '<div class="empty-state">' +
          '<div class="empty-icon">ğŸ“</div>' +
          '<div class="empty-text">' + t('today.empty') + '</div>' +
          '<div class="empty-desc" style="font-size: 12px; color: var(--color-text); opacity: 0.5; margin: 12px 0 20px;">' + 
          (t('today.emptyDesc') || 'å¼€å§‹è®°å½•ä½ çš„åŠŸè¿‡ï¼ŒåŸ¹å…»è‡ªçœä¹ æƒ¯') + '</div>' +
          '<button class="empty-action-btn" style="padding: 12px 32px; background: var(--gradient-primary); color: var(--color-bg); border: none; border-radius: var(--radius-md); font-size: 14px; font-weight: 500; cursor: pointer; transition: transform 0.2s;">' +
          (t('today.goRecord') || 'å»è®°å½•') + '</button>' +
          '</div>';
        
        // ç»‘å®šç©ºçŠ¶æ€æŒ‰é’®
        var emptyBtn = listArea.querySelector('.empty-action-btn');
        if (emptyBtn) {
          emptyBtn.addEventListener('click', function() {
            window.location.href = 'record.html?type=gong';
          });
        }
      }

      // ç›‘å¬ä¸»é¢˜å˜åŒ–ï¼Œæ›´æ–°æ—¥æœŸæ˜¾ç¤º
      document.addEventListener('themeChanged', function () {
        var dateInfo = formatDate(today);
        document.getElementById('dateMain').textContent = dateInfo.main;
        document.getElementById('dateSub').textContent = dateInfo.sub;
      });
    });
  </script>
</body>

</html>